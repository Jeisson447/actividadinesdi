image: node:18

pipelines:
  default:
    - step:
        name: "ğŸ”§ Instalar dependencias"
        caches:
          - node
        script:
          - npm install
        artifacts:
          - node_modules/**

    - step:
        name: "ğŸ§ª Ejecutar pruebas unitarias"
        script:
          - npm test

    - step:
        name: "âœ… AnÃ¡lisis de calidad de cÃ³digo (ESLint)"
        script:
          - npm run lint || echo "Errores de lint encontrados, revisar."

    - step:
        name: "ğŸš€ Compilar aplicaciÃ³n (build)"
        script:
          - npm run build
        artifacts:
          - dist/**

    - step:
        name: "ğŸ§ª VerificaciÃ³n funcional"
        script:
          - npm run test:functional

    - step:
        name: "ğŸŒ Despliegue en entorno de prueba (staging)"
        deployment: staging
        script:
          - echo "Desplegando en Vercel (Staging)..."
          - curl -X POST "https://api.vercel.com/v1/integrations/deploy/prj_5PfikStOrQZxYtgUs7C0JhCnI3AQ/AXcvFwp3cj"

    - step:
        name: "ğŸš€ Despliegue en entorno de producciÃ³n"
        deployment: production
        trigger: manual
        script:
          - echo "Desplegando en Vercel (ProducciÃ³n)..."
          - curl -X POST "https://api.vercel.com/v1/integrations/deploy/prj_5PfikStOrQZxYtgUs7C0JhCnI3AQ/Bv8AAcSxYS"
